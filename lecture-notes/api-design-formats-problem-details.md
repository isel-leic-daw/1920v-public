## HTTP API design - Formats - Problem Details for HTTP APIs

### The meaning of meaning

What is the meaning of the following payload?

```
Content-Type: text/plain; charset=utf-8

{
  "type": "https://example.com/problems/invalid-input",
  "status": 400
}
```

- It probably depends on the a-priori context?
- And without context (e.g. for a generic intermediary)?
  - It is just a sequence of characters, starting at `'{'` and ending at `'}'`.

And what is the meaning of the following payload (notice the `Content-Type`)

```
Content-Type: application/json

{
  "type": "https://example.com/problems/invalid-input",
  "status": 400
}
```
- Now it is
  - A JSON object with two fields
  - The first field has the name `type` and its value is the string `https://example.com/problems/invalid-input`
  - The second field has the name `status` and its value is the number `400`

And what is the meaning of the following payload

```
Content-Type: application/problem+json

{
  "type": "https://example.com/problems/invalid-input",
  "status": 400
}
```
- Now it is
  - The representation of a problem, according to RFC 7807
  - The problem type is the URI `https://example.com/problems/invalid-input`
  - The status code generated by the origin server for this occurrence of the problem was `400`.

- And what if the intermediary isn't aware of `application/problem+json`?
  - Then it is just a sequence of bytes.

And what is the meaning of the following payload

```
Content-Type: application/problem+xml

<?xml version="1.0" encoding="UTF-8"?>
<problem xmlns="urn:ietf:rfc:7807">
  <type>https://example.com/problems/invalid-input</type>
  <status>400</status>
</problem>
```
- Now it is
  - The representation of a problem, according to RFC 7807
  - The problem type is the URI `https://example.com/problems/invalid-input``
  - The status code generated by the origin server for this occurrence of the problem was `400`.

### RFC 7807 ("Problem Details for HTTP APIs")

In the abstract

> This document defines a "problem detail" as a way to carry machine-
   readable details of errors in a HTTP response to avoid the need to
   define new error response formats for HTTP APIs.

```
A problem details object can have the following members:

   o  "type" (string) - A URI reference [RFC3986] that identifies the
      problem type.  This specification encourages that, when
      dereferenced, it provide human-readable documentation for the
      problem type (e.g., using HTML [W3C.REC-html5-20141028]).  When
      this member is not present, its value is assumed to be
      "about:blank".

   o  "title" (string) - A short, human-readable summary of the problem
      type.  It SHOULD NOT change from occurrence to occurrence of the
      problem, except for purposes of localization (e.g., using
      proactive content negotiation; see [RFC7231], Section 3.4).

   o  "status" (number) - The HTTP status code ([RFC7231], Section 6)
      generated by the origin server for this occurrence of the problem.

   o  "detail" (string) - A human-readable explanation specific to this
      occurrence of the problem.

   o  "instance" (string) - A URI reference that identifies the specific
      occurrence of the problem.  It may or may not yield further
      information if dereferenced.
```

> Problem details are not a debugging tool for the underlying
   implementation; rather, they are a way to expose greater detail about
   the HTTP interface itself. 

> Likewise, truly generic problems -- i.e., conditions that could
   potentially apply to any resource on the Web -- are usually better
   expressed as plain status codes.  For example, a "write access
   disallowed" problem is probably unnecessary, since a 403 Forbidden
   status code in response to a PUT request is self-explanatory.


And what is the meaning of this

```
Content-Type: application/problem+json

{
  "type": "https://example.com/problems/invalid-input",
  "status": 400,
  "fieldName": "userName"
}
```

- Now it is
  - The representation of a problem, according to RFC 7807
  - The problem type is the URI `https://example.com/problems/invalid-input``
  - The status code generated by the origin server for this occurrence of the problem was `400`.
  - And how about the `"fieldName":"userName"`?
    - If the processor does NOT have knowledge about the `https://example.com/problems/invalid-input` type, then is just a field with a value.
    - If the processor does HAVE knowledge about `https://example.com/problems/invalid-input`, then `fieldName` is interpreted according to it
      - E.g. it contains the name of the input field that is not valid.


Example: [Akamai](https://developer.akamai.com/api/core_features/api_endpoints/v2.html#errortypes)

```
HTTP/1.1 403 Forbidden
Content-Type: application/problem+json
Content-Language: en

{
  "type": "https://example.com/probs/out-of-credit",
  "title": "You do not have enough credit.",
  "detail": "Your current balance is 30, but that costs 50.",
  "instance": "/account/12345/msgs/abc",
  "_data": {
    "balance": 30,
    "accounts": ["/account/12345",
                "/account/67890"]
  }
}
```

Summary:
- Useful for intermediaries - increases visibility and reuse
- Avoid the "reinventing the wheel" problem
